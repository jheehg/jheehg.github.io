---
layout: post
title: Typescript Exercise 10 í’€ì–´ë³´ê³  ì •ë¦¬í•´ë³´ê¸°
description: Typescript Exercise 10 í’€ì–´ë³´ê¸°
summary: Typescript Exercise 10 í’€ì–´ë³´ê³  ì •ë¦¬í•´ë³´ëŠ” ê¸€ì…ë‹ˆë‹¤.
comments: true
categories: [FE]
tags: [typescript]
---
<br>
íƒ€ì…ìŠ¤í¬ë¦½íŠ¸ í•™ìŠµì„ ìœ„í•´ TypeScript exercises ë¬¸ì œë¥¼ í’€ì–´ë³´ê³ 
ê¸°ì–µ ë³´ê´€ ëª©ì ìœ¼ë¡œ ì •ë¦¬í•´ë³´ëŠ” ê¸€ì…ë‹ˆë‹¤. ğŸ˜€ <br><br><br>

### â¯ Exercise 10.
ë°ì´í„°ë¥¼ ìš”ì²­í•˜ëŠ” í•¨ìˆ˜ë¥¼ ì¬ì‹¤í–‰í•˜ì§€ ì•Šê¸° ìœ„í•´,<br>
ê¸°ì¡´ì˜ ì½”ë“œ ë² ì´ìŠ¤ë¡œ Promiseë¡œ ë¹„ë™ê¸° ì²˜ë¦¬í•˜ëŠ” í•¨ìˆ˜ë¥¼ ìƒì„±í•´ë³´ê¸°.<br>
ìµœì¢…ì ìœ¼ë¡œ ê²°ê³¼ê°€ ì„±ê³µí•˜ë©´ ë°ì´í„°ë¥¼, ì‹¤íŒ¨í•˜ë©´ ì—ëŸ¬ë©”ì‹œì§€ë¥¼ ë¦¬í„´í•˜ëŠ” `Promise` ê°ì²´ë¥¼ ë¦¬í„´í•˜ë„ë¡ í•´ì•¼í•œë‹¤.<br>
ìƒˆë¡œ ë§Œë“œëŠ” í•¨ìˆ˜ì˜ ì´ë¦„ì€ `promisify`ë¡œ ëª…ëª…í•œë‹¤.<br>
\+ <br>
ëª¨ë“  ìš”ì²­ì„ objectë¡œ ë‹´ê³  ì´ ìš”ì²­ë“¤ì„ ê°ê° promisifyë¥¼ í•˜ë„ë¡ í•˜ëŠ” í•¨ìˆ˜ `promisifyAll` ë¥¼ ë§Œë“¤ì–´ë³´ê¸°.<br>
ì•„ë˜ ì½”ë“œì²˜ëŸ¼ `promisifyAll` ê°€ ë¦¬í„´í•˜ëŠ” ê°ì²´ë¥¼ apiì— í• ë‹¹í•˜ê¸°<br>
```js
const api = promisifyAll(oldApi);
```

<br><br>

### íƒ€ì… ì •ì˜ ë° ì‚¬ìš© ë°ì´í„°

`User`, `Admin` ê°ê°ì˜ ì¸í„°í˜ì´ìŠ¤ë“¤ì€ ìœ ë‹ˆì˜¨ íƒ€ì…(`Union Type`)ì„ ì‚¬ìš©í•´ `Person`ì´ë¼ëŠ” íƒ€ì…ì„ ìƒì„±í•œë‹¤. <br>
typeì€ ê³µí†µ í•„ë“œì§€ë§Œ ì œí•œê°’ì´ ë‹¤ë¥´ê³  `occupation`ì€ User ì¸í„°í˜ì´ìŠ¤ì—, `role`ì€ Admin ì¸í„°í˜ì´ìŠ¤ì—ë§Œ ì •ì˜ë˜ì–´ ìˆë‹¤.<br>
```js
interface User {
    type: 'user';
    name: string;
    age: number;
    occupation: string;
}

interface Admin {
    type: 'admin';
    name: string;
    age: number;
    role: string;
}

type Person = User | Admin;

const admins: Admin[] = [
    { type: 'admin', name: 'Jane Doe', age: 32, role: 'Administrator' },
    { type: 'admin', name: 'Bruce Willis', age: 64, role: 'World saver' }
];

const users: User[] = [
    { type: 'user', name: 'Max Mustermann', age: 25, occupation: 'Chimney sweep' },
    { type: 'user', name: 'Kate MÃ¼ller', age: 23, occupation: 'Astronaut' }
];
```
<br><br>
API ìš”ì²­ì— ëŒ€í•œ ì‘ë‹µê²°ê³¼ë¥¼ ì •ì˜í•˜ëŠ” `ApiResponse` ë¥¼ íƒ€ì…ìœ¼ë¡œ ì ìš©í• ë•Œ<br>
í•¨ìˆ˜ì²˜ëŸ¼ ì ìš©ë  ìˆ˜ ìˆë„ë¡ ì œë„¤ë¦­`T` ì„ ì‚¬ìš©í•œë‹¤. ì—¬ê¸°ì— `User[]`, `Admin[]` ë˜ëŠ” ê·¸ ì™¸ì— ê°’ ë˜í•œ ì‚¬ìš©ì´ ê°€ëŠ¥í•˜ë‹¤.<br>

```js
export type ApiResponse<T> = (
    {
        status: 'success';
        data: T;
    } |
    {
        status: 'error';
        error: string;
    }
);
```

<br><br>
`oldApi` ì— ê° ìš”ì²­ì´ ì •ì˜ë˜ì–´ ìˆë‹¤. ê° ìš”ì²­í•¨ìˆ˜ì˜ ì¸ìë¡œ callback í•¨ìˆ˜ê°€ ì‚¬ìš©ë˜ëŠ”ë° ì´ë¥¼ `ApiFunction` íƒ€ì…ìœ¼ë¡œ <br>ì •ì˜í•œë‹¤.
íƒ€ì… ì •ì˜í• ë•Œ, ì œë„¤ë¦­ì„ ì‚¬ìš©í•´ì„œ ì¸ì íƒ€ì…ì¸ `ApiFunction`ì—ì„œë„ ë˜í•œ ì‚¬ìš©ë  ìˆ˜ ìˆë„ë¡ í•œë‹¤.
```js

type ApiFunction<T> = (callback: (response: ApiResponse<T>) => void) => void;

const oldApi = {
    requestAdmins(callback: (response: ApiResponse<Admin[]>) => void) {
        callback({
            status: 'success',
            data: admins
        });
    },
    requestUsers(callback: (response: ApiResponse<User[]>) => void) {
        callback({
            status: 'success',
            data: users
        });
    },
    requestCurrentServerTime(callback: (response: ApiResponse<number>) => void) {
        callback({
            status: 'success',
            data: Date.now()
        });
    },
    requestCoffeeMachineQueueLength(callback: (response: ApiResponse<number>) => void) {
        callback({
            status: 'error',
            error: 'Numeric value has exceeded Number.MAX_SAFE_INTEGER.'
        });
    }
};
```

<br><br>
`promisifyAll` í•¨ìˆ˜ëŠ” ê° ìš”ì²­í•¨ìˆ˜ë¥¼ ë‹´ê³ ìˆëŠ” `oldApi`ë¥¼ ì¸ìë¡œ ë°›ì•„ì„œ ìš”ì²­ë“¤ì„ `promisify` í•˜ëŠ” ì—­í• ì„ í•œë‹¤.
```js
export const api = promisifyAll(oldApi);
```
<br><br>

`promisify` í•¨ìˆ˜ëŠ” `ApiFunction` íƒ€ì…ì˜ ì½œë°±í•¨ìˆ˜ë¥¼ ì¸ìë¡œ ë°›ê³  `() => Promise` íƒ€ì…ìœ¼ë¡œ ë¦¬í„´í•˜ê²Œ ëœë‹¤. <br>
Promiseê°ì²´ ë‚´ë¶€ì—ì„œëŠ” ê° API ìš”ì²­ì— ëŒ€í•œ ê²°ê³¼ë¥¼ ì²˜ë¦¬í•˜ëŠ” ì½”ë“œê°€ ì§„í–‰ëœë‹¤.<br>
```js
type ReturnPromise<T> = () => Promise<T>;

export function promisify<T>(arg: ApiFunction<T>): ReturnPromise<T> {
    return () => new Promise<T>((resolve, reject) => {
        arg((response) => {
            if(response.status === 'success') {
            resolve(response.data);
            } else {
                reject(new Error(response.error));
            }
        });
    });
}
```
<br><br>

`promisifyAll` í•¨ìˆ˜ëŠ” ê° ìš”ì²­ì˜ ì½œë°±í•¨ìˆ˜ë¥¼ ë‹´ì€ objectë¥¼ ì¸ìë¡œ ë°›ê³ ,<br>
ê·¸ objectë¥¼ ë¦¬í„´í•˜ë˜ value ê°’ì€ ê° ìš”ì²­ì— ëŒ€í•´ì„œ promisify í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•œ ê²°ê³¼ë¥¼ ë‹´ì•„ ë¦¬í„´í•œë‹¤.<br>
ê·¸ í›„ì— objectì˜ í‚¤ê°’ì„ í˜¸ì¶œí•˜ë©´ API ì‘ë‹µê²°ê³¼ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ ëœë‹¤.
```js
type ApiObject<T> = {[K in keyof T]: ApiFunction<T[K]>};
type PromiseResult<T> = {[K in keyof T]: ReturnPromise<T[K]>};


export function promisifyAll<T extends {[key: string]: any}>(obj: ApiObject<T>): PromiseResult<T> {
    let result:Partial<PromiseResult<T>> = {};
    for(const requestApi of Object.keys(obj)) {
        result[requestApi as keyof ApiObject<T>] = promisify(obj[requestApi]);
    }
    return result as PromiseResult<T>;
}
```
<br><br>
### PromisifyAll í•¨ìˆ˜ ì¢€ ë” ì•Œì•„ë³´ê¸°

ì œë„¤ë¦­ íƒ€ì…ìœ¼ë¡œ ì‚¬ìš©ë˜ëŠ” `T` ì˜ í˜•íƒœë¥¼ ì•„ë˜ì™€ ê°™ì´ ì œí•œí•œë‹¤.<br>
```js
<T extends {[key: string]: any}>
```

<br>
ì²˜ìŒì—ëŠ” ë¹ˆ ê°ì²´ê°€ ê¸°ë³¸ê°’ìœ¼ë¡œ í• ë‹¹ë˜ê¸° ë•Œë¬¸ì— <u>Partial</u> ë¡œ ì •ì˜í•´ì£¼ì–´ì•¼ ì˜¤ë¥˜ê°€ ë‚˜ì§€ ì•ŠëŠ”ë‹¤.<br>
```js
let result:Partial<PromiseResult<T>> = {};
```
<br><br>

`for .. of` ì—ì„œ ì •ì˜ëœ `requestApi` ì€ `string` íƒ€ì…ì´ê¸° ë•Œë¬¸ì— ì•„ë˜ `result` ê°ì²´ì˜ í‚¤ê°’ìœ¼ë¡œ ì‚¬ìš©í•  ë•Œ<br>
ë‹¤ì‹œ í•œë²ˆ `ApiObject<T>` ì˜ í‚¤ íƒ€ì…ìœ¼ë¡œ í˜•ë³€í™˜ í•´ì£¼ì–´ì•¼ í•œë‹¤.
```js
for(const requestApi of Object.keys(obj)) {
  result[requestApi as keyof ApiObject<T>] = promisify(obj[requestApi]);
}
```
<br><br>
<u>ApiObject: `oldApi` ê°ì²´ë¥¼ ë‹´ëŠ” íƒ€ì…</u><br>
<u>PromiseResult: ApiObjectì™€ key ê°’ì€ ê°™ì§€ë§Œ `Promisify` í˜¸ì¶œ ê²°ê³¼ì¸ `() => Promise` ë¥¼ ë‹´ëŠ” íƒ€ì…</u><br>

`promisifyAll` ìì²´ì—ì„œ Tì˜ í‚¤ì¸ Kë¥¼ `any`íƒ€ì…ìœ¼ë¡œ ì •ì˜í–ˆê¸° ë•Œë¬¸ì— `ApiFunction<any>` ê°€ ë˜ê³ ,<br>
`any` íƒ€ì…ì´ê¸° ë•Œë¬¸ì— promisify ë‚´ì—ì„œë„ ì˜¤ë¥˜ê°€ ë‚˜ì§€ ì•ŠëŠ” ê²ƒ ê°™ë‹¤. <br>(promisifyì—ì„œëŠ” User[], Admin[], number ë¡œ ì§€ì •í•´ì„œ ì‚¬ìš©ë˜ì—ˆë‹¤.)<br>
ì´ ë¶€ë¶„ì´ ì œì¼ ì´í•´ê°€ ê°€ì§€ ì•Šì•˜ëŠ”ë° ì—¬ê¸°ì„œ `any` íƒ€ì…ì´ ì•„ë‹Œ íŠ¹ì •í•œ ê°ì²´ë¡œ íƒ€ì…ì„ ì§€ì •í•˜ê²Œ ë˜ë©´<br> ApiFunction ì‚¬ìš©í•  ë•Œ
íƒ€ì… ì˜¤ë¥˜ê°€ ë‚˜ê¸° ë•Œë¬¸ì¼ê¹Œ?<br> `any` íƒ€ì… ë§ê³  ë‹¤ë¥¸ ë°©ë²•ì€ ì—†ì„ì§€ ê¶ê¸ˆí•˜ê³  ë‚´ê°€ ì¶”ì¸¡í•œê²Œ ë§ëŠ”ì§€ë„ ê¶ê¸ˆí•˜ë‹¤. ğŸ¤”
```
type ApiObject<T> = {[K in keyof T]: ApiFunction<T[K]>};
type PromiseResult<T> = {[K in keyof T]: ReturnPromise<T[K]>};
```

<br><br><br>
ì•„ë˜ ì½”ë“œëŠ” promisifyëœ ìš”ì²­ë“¤ì— ëŒ€í•œ ì‘ë‹µì„ ì‚¬ìš©í•˜ëŠ” í•¨ìˆ˜ë“¤ì´ë‹¤.<br>
```js
function logPerson(person: Person) {
    console.log(
        ` - ${person.name}, ${person.age}, ${person.type === 'admin' ? person.role : person.occupation}`
    );
}

async function startTheApp() {
    console.log('Admins:');
    (await api.requestAdmins()).forEach(logPerson);
    console.log();

    console.log('Users:');
    (await api.requestUsers()).forEach(logPerson);
    console.log();

    console.log('Server time:');
    console.log(`   ${new Date(await api.requestCurrentServerTime()).toLocaleString()}`);
    console.log();

    console.log('Coffee machine queue length:');
    console.log(`   ${await api.requestCoffeeMachineQueueLength()}`);
}

startTheApp().then(
    () => {
        console.log('Success!');
    },
    (e: Error) => {
        console.log(`Error: "${e.message}", but it's fine, sometimes errors are inevitable.`);
    }
);
```
<br><br><br><br>

<b>ëª¨ë“  ì†ŒìŠ¤ëŠ” ì•„ë˜ ë§í¬ì—ì„œ ì°¸ê³ í•˜ì˜€ìŠµë‹ˆë‹¤</b><br>
<https://typescript-exercises.github.io/#exercise=10&file=%2Findex.ts>

